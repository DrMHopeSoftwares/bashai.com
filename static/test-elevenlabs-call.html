<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElevenLabs Call Test - BhashAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .call-button {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transition: all 0.3s ease;
        }
        .call-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
        }
        .voice-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .voice-card:hover {
            border-color: #f59e0b;
            transform: translateY(-2px);
        }
        .voice-card.selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="gradient-bg text-white py-8">
            <div class="container mx-auto px-4">
                <div class="text-center">
                    <h1 class="text-4xl font-bold mb-2">
                        <i class="fas fa-microphone-alt mr-3"></i>
                        ElevenLabs Call Test
                    </h1>
                    <p class="text-xl opacity-90">Test phone calls using ElevenLabs AI voice agents</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <!-- Call Configuration -->
                <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-phone mr-2 text-orange-600"></i>
                        Call Configuration
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Phone Number -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="phoneNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" 
                                   value="+919373111709" placeholder="+91XXXXXXXXXX">
                            <p class="text-sm text-gray-600 mt-1">Enter the phone number to call</p>
                        </div>

                        <!-- Language -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Language</label>
                            <select id="language" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="hi">Hindi</option>
                                <option value="en">English</option>
                                <option value="hinglish">Hinglish</option>
                            </select>
                        </div>
                    </div>

                    <!-- Message -->
                    <div class="mt-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Initial Message</label>
                        <textarea id="message" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                  placeholder="Enter the initial message for the call">‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç BhashAI ‡§∏‡•á ‡§è‡§ï AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Ç‡•§ ‡§Ø‡§π ‡§è‡§ï ‡§ü‡•á‡§∏‡•ç‡§ü ‡§ï‡•â‡§≤ ‡§π‡•à‡•§ ‡§Ü‡§ú ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç?</textarea>
                    </div>
                </div>

                <!-- Voice Selection -->
                <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-user-circle mr-2 text-orange-600"></i>
                        Select Voice
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="voiceSelection">
                        <!-- Voice cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Call Buttons -->
                <div class="text-center mb-8 space-y-4">
                    <div>
                        <button id="makeCallBtn" class="call-button text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg mr-4">
                            <i class="fas fa-phone mr-2"></i>
                            Make Test Call
                        </button>
                        <button id="makeRealCallBtn" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transition-all duration-300">
                            <i class="fas fa-phone-alt mr-2"></i>
                            Make Real Call to +919373111709
                        </button>
                    </div>
                    <p class="text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        Test Call = Mock mode | Real Call = Actual phone call using ElevenLabs API
                    </p>
                </div>

                <!-- Call Status -->
                <div id="callStatus" class="bg-white rounded-2xl shadow-lg p-8 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                        Call Status
                    </h2>
                    <div id="statusContent">
                        <!-- Status content will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Call Log -->
                <div id="callLog" class="bg-white rounded-2xl shadow-lg p-8 hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-list mr-2 text-green-600"></i>
                        Call Log
                    </h2>
                    <div id="logContent">
                        <!-- Log content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Available voices
        const voices = [
            {
                id: 'pNInz6obpgDQGcFmaJgB',
                name: 'Adam',
                description: 'Deep, authoritative male voice',
                gender: 'male',
                accent: 'American'
            },
            {
                id: '21m00Tcm4TlvDq8ikWAM',
                name: 'Rachel',
                description: 'Calm, professional female voice',
                gender: 'female',
                accent: 'American'
            },
            {
                id: 'AZnzlk1XvdvUeBnXmlld',
                name: 'Domi',
                description: 'Strong, confident female voice',
                gender: 'female',
                accent: 'American'
            },
            {
                id: 'EXAVITQu4vr4xnSDxMaL',
                name: 'Bella',
                description: 'Friendly, warm female voice',
                gender: 'female',
                accent: 'American'
            },
            {
                id: 'ErXwobaYiN019PkySvjV',
                name: 'Antoni',
                description: 'Smooth, articulate male voice',
                gender: 'male',
                accent: 'British'
            }
        ];

        let selectedVoiceId = '21m00Tcm4TlvDq8ikWAM'; // Default to Rachel

        // Initialize voice selection
        function initializeVoices() {
            const voiceContainer = document.getElementById('voiceSelection');
            
            voices.forEach(voice => {
                const voiceCard = document.createElement('div');
                voiceCard.className = `voice-card p-4 border rounded-lg cursor-pointer ${voice.id === selectedVoiceId ? 'selected' : ''}`;
                voiceCard.onclick = () => selectVoice(voice.id);
                
                voiceCard.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl mb-2">
                            ${voice.gender === 'male' ? 'üë®' : 'üë©'}
                        </div>
                        <h3 class="font-bold text-gray-800">${voice.name}</h3>
                        <p class="text-sm text-gray-600 mt-1">${voice.description}</p>
                        <p class="text-xs text-gray-500 mt-1">${voice.accent} accent</p>
                    </div>
                `;
                
                voiceContainer.appendChild(voiceCard);
            });
        }

        // Select voice
        function selectVoice(voiceId) {
            selectedVoiceId = voiceId;
            
            // Update UI
            document.querySelectorAll('.voice-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
        }

        // Make test call (mock mode)
        async function makeCall() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const language = document.getElementById('language').value;
            const message = document.getElementById('message').value;
            const makeCallBtn = document.getElementById('makeCallBtn');

            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }

            // Update button state
            makeCallBtn.disabled = true;
            makeCallBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Making Test Call...';

            // Show status
            showCallStatus('Initiating test call...', 'info');

            try {
                const response = await fetch('/api/elevenlabs/make-test-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone_number: phoneNumber,
                        voice_id: selectedVoiceId,
                        message: message,
                        language: language
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showCallStatus('Test call initiated successfully!', 'success');
                    showCallLog(result, 'test');
                } else {
                    showCallStatus(`Test call failed: ${result.error}`, 'error');
                }

            } catch (error) {
                console.error('Call error:', error);
                showCallStatus(`Test call failed: ${error.message}`, 'error');
            } finally {
                // Reset button
                makeCallBtn.disabled = false;
                makeCallBtn.innerHTML = '<i class="fas fa-phone mr-2"></i>Make Test Call';
            }
        }

        // Make real call (production mode)
        async function makeRealCall() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const language = document.getElementById('language').value;
            const message = document.getElementById('message').value;
            const makeRealCallBtn = document.getElementById('makeRealCallBtn');

            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }

            // Confirmation for real call
            const confirmed = confirm(`‚ö†Ô∏è IMPORTANT: This will make a REAL phone call to ${phoneNumber} using ElevenLabs AI.\n\nMake sure you have permission to call this number.\n\nProceed with the call?`);
            if (!confirmed) {
                return;
            }

            // Update button state
            makeRealCallBtn.disabled = true;
            makeRealCallBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Making Real Call...';

            // Show status
            showCallStatus('Initiating real phone call...', 'info');

            try {
                const response = await fetch('/api/twilio-elevenlabs/make-call', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone_number: phoneNumber,
                        voice_id: selectedVoiceId,
                        message: message,
                        language: language,
                        record_call: false
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showCallStatus('Real call initiated successfully! üìû', 'success');
                    showCallLog(result, 'real');
                } else {
                    showCallStatus(`Real call failed: ${result.error}`, 'error');
                }

            } catch (error) {
                console.error('Real call error:', error);
                showCallStatus(`Real call failed: ${error.message}`, 'error');
            } finally {
                // Reset button
                makeRealCallBtn.disabled = false;
                makeRealCallBtn.innerHTML = '<i class="fas fa-phone-alt mr-2"></i>Make Real Call to +919373111709';
            }
        }

        // Show call status
        function showCallStatus(message, type) {
            const statusDiv = document.getElementById('callStatus');
            const statusContent = document.getElementById('statusContent');
            
            const iconClass = type === 'success' ? 'fa-check-circle text-green-600' : 
                             type === 'error' ? 'fa-exclamation-circle text-red-600' : 
                             'fa-info-circle text-blue-600';
            
            const bgClass = type === 'success' ? 'bg-green-50 border-green-200' : 
                           type === 'error' ? 'bg-red-50 border-red-200' : 
                           'bg-blue-50 border-blue-200';

            statusContent.innerHTML = `
                <div class="flex items-center p-4 rounded-lg border ${bgClass}">
                    <i class="fas ${iconClass} text-xl mr-3"></i>
                    <span class="text-gray-800">${message}</span>
                </div>
            `;
            
            statusDiv.classList.remove('hidden');
        }

        // Show call log
        function showCallLog(result, callType = 'test') {
            const logDiv = document.getElementById('callLog');
            const logContent = document.getElementById('logContent');

            const selectedVoice = voices.find(v => v.id === selectedVoiceId);
            const isRealCall = callType === 'real';

            const statusBadge = isRealCall ?
                '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-semibold">üî¥ LIVE CALL</span>' :
                '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-semibold">üß™ TEST MODE</span>';

            logContent.innerHTML = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Call Log</h3>
                        ${statusBadge}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-2">Call Details</h4>
                            <p><strong>Phone:</strong> ${result.phone_number}</p>
                            <p><strong>Call ID:</strong> ${result.call_id}</p>
                            <p><strong>Agent ID:</strong> ${result.agent_id}</p>
                            <p><strong>Session ID:</strong> ${result.session_id || 'N/A'}</p>
                            ${result.twilio_call_sid ? `<p><strong>Twilio SID:</strong> ${result.twilio_call_sid}</p>` : ''}
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-700 mb-2">Voice Settings</h4>
                            <p><strong>Voice:</strong> ${selectedVoice.name}</p>
                            <p><strong>Provider:</strong> ElevenLabs</p>
                            <p><strong>Language:</strong> ${document.getElementById('language').value}</p>
                            <p><strong>Status:</strong> <span class="text-green-600">${result.status || 'Active'}</span></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-700 mb-2">Initial Message</h4>
                        <p class="text-gray-600">${document.getElementById('message').value}</p>
                    </div>
                    ${isRealCall ? `
                    <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">
                            <i class="fas fa-phone-alt mr-2"></i>Real Call Initiated
                        </h4>
                        <p class="text-green-700">
                            üìû A real phone call has been initiated to <strong>${result.phone_number}</strong><br>
                            üéôÔ∏è The AI assistant will introduce itself using ElevenLabs voice technology<br>
                            ‚è±Ô∏è The call should connect within 30 seconds<br>
                            üìä Call status and analytics will be tracked automatically
                        </p>
                    </div>
                    ` : `
                    <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">
                            <i class="fas fa-flask mr-2"></i>Test Mode
                        </h4>
                        <p class="text-blue-700">This was a test call simulation. No actual phone call was made. Use "Make Real Call" button for actual calls.</p>
                    </div>
                    `}
                </div>
            `;

            logDiv.classList.remove('hidden');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeVoices();

            // Add event listeners to call buttons
            document.getElementById('makeCallBtn').addEventListener('click', makeCall);
            document.getElementById('makeRealCallBtn').addEventListener('click', makeRealCall);
            
            // Update message based on language selection
            document.getElementById('language').addEventListener('change', function() {
                const messageTextarea = document.getElementById('message');
                const language = this.value;
                
                if (language === 'hi') {
                    messageTextarea.value = '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç BhashAI ‡§∏‡•á ‡§è‡§ï AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Ç‡•§ ‡§Ø‡§π ‡§è‡§ï ‡§ü‡•á‡§∏‡•ç‡§ü ‡§ï‡•â‡§≤ ‡§π‡•à‡•§ ‡§Ü‡§ú ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç?';
                } else if (language === 'en') {
                    messageTextarea.value = 'Hello! I am an AI assistant from BhashAI. This is a test call. How can I help you today?';
                } else if (language === 'hinglish') {
                    messageTextarea.value = 'Hello! Main BhashAI se ek AI assistant hun. Ye ek test call hai. Aaj main aapki kaise help kar sakta hun?';
                }
            });
        });
    </script>
</body>
</html>
